name: Compile AHK Script to EXE

on:
  workflow_dispatch: # Only triggers manually

jobs:
  build:
    runs-on: windows-latest

    steps:
      # Checkout the code from the repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Compile the AHK script to EXE using ahk2exe with /bin option for Unicode 64-bit binary
      - name: Compile AHK script to EXE
        run: |
          # Ensure ahk2exe is executable
          Set-ExecutionPolicy Bypass -Scope Process -Force
          
          # Run ahk2exe directly and capture output
          & ".\ahk2exe\ahk2exe.exe" /in ".\code\Blower.ahk" /bin "Unicode 64-bit.bin" | Tee-Object -FilePath ahk2exe_output.log

      # Check if any EXE file was created
      - name: Verify EXE creation
        run: |
          $exeFiles = Get-ChildItem -Path ".\" -Filter *.exe
          if ($exeFiles.Count -gt 0) {
            Write-Host "EXE files successfully created:"
            $exeFiles | ForEach-Object { Write-Host $_.FullName }
          } else {
            Write-Error "No EXE files found after compilation."
            exit 1
          }

      # Upload the EXE as an artifact
      - name: Upload compiled EXE
        uses: actions/upload-artifact@v4
        with:
          name: compiled-ahk-exe
          path: .\*.exe

      # Upload the log for debugging purposes
      - name: Upload ahk2exe output log
        uses: actions/upload-artifact@v4
        with:
          name: ahk2exe-output-log
          path: ahk2exe_output.log
